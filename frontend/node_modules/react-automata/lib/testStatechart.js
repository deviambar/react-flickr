'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactTestRenderer = require('react-test-renderer');

var _reactTestRenderer2 = _interopRequireDefault(_reactTestRenderer);

var _xstate = require('xstate');

var _graph = require('xstate/lib/graph');

var _ = require('./');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var testStatechart = function testStatechart(config, Component) {
  var paths = (0, _graph.getShortestPaths)((0, _xstate.Machine)(config.statechart));

  Object.keys(paths).forEach(function (key) {
    var initialData = config.fixtures ? config.fixtures.initialData : null;
    var StateMachine = (0, _.withStatechart)(config.statechart, { initialData: initialData })(Component);
    var renderer = _reactTestRenderer2.default.create(_react2.default.createElement(StateMachine, null));
    var instance = renderer.getInstance();

    paths[key].forEach(function (_ref) {
      var event = _ref.event,
          state = _ref.state;

      var fixtures = config.fixtures && config.fixtures[state] ? config.fixtures[state][event] : null;

      instance.handleTransition(event, fixtures);
    });

    var machineState = instance.state.machineState;

    expect(renderer.toJSON()).toMatchSnapshot(machineState);
  });
};

exports.default = testStatechart;